
[今天一次性给你讲清楚：File、Blob、FileReader、ArrayBuffer、Base64_file blob_我们一起学前端的博客-CSDN博客](https://blog.csdn.net/qq_35577655/article/details/127169333?spm=1001.2014.3001.5501)

![[Pasted image 20230901151227.png]]

# Blob 对象

- Blob 全称为 binary large object ，即二进制大对象。blob对象本质上是js中的一个对象，里面可以储存大量的二进制[编码格式](https://so.csdn.net/so/search?q=%E7%BC%96%E7%A0%81%E6%A0%BC%E5%BC%8F&spm=1001.2101.3001.7020)的数据。Blob 对象一个不可修改，从Blob中读取内容的唯一方法是使用 FileReader。

## 创建

```js
new Blob(array,options)
```

- array：由 ArrayBuffer、ArrayBufferView、Blob、DOMString 等对象构成的，将会被放进 Blob；
- options：它可能会指定如下两个属性
	   - type：默认值为 ""，表示将会被放入到 blob 中的数组内容的 MIME 类型。
	   - endings：默认值为"transparent"，用于指定包含行结束符\n的字符串如何被写入，不常用。

|MIMIE类型|描述|
|---------|----|
|text/plain|纯文本文档|
|text/html|html文档|
|text/javascript|js文件|
|text/css|css|
|application/json|json|
|application/pdf|pdf|
|application/xml|xml|
|image/jpeg||
|image/png||
|image/git||
|image/svg+xml|svg|
|aduio/mpeg|mp3|
|video/mped|mp4|

eg.
```js
      var str = `<div><p>123</p></div>`;
      var blob = new Blob([str], {
        type: "text/html",
      });
      console.log(blob, "blob");
```

控制台输出
```
Blob { size: 21, type: "text/html" }
size: 21
type: "text/html"
<prototype>: BlobPrototype { slice: slice(), stream: stream(), text: text(), … }
```

## 分片

- Blob 对象内置了 slice() 方法用来将 blob 对象分片。其有三个参数：
	start：设置切片的起点，即切片开始位置。默认值为 0，这意味着切片应该从第一个字节开始；
	end：设置切片的结束点，会对该位置之前的数据进行切片。默认值为blob.size；
	contentType：设置新 blob 的 MIME 类型。如果省略 type，则默认为 blob 的原始值。



# File

- File 对象是特殊类型的 Blob，在 JavaScript 中，主要有两种方法来获取 File 对象：
	1. input 元素上选择文件后返回的 FileList 对象；
	2. 文件拖放操作生成的 DataTransfer 对象

eg.
```js
 input.onchange = function (e) {
        var file = e.target.files[0];
        console.log(file,"file")
      };
      box.ondrop = function (e) {
        e.preventDefault();
        var files = e.dataTransfer.files;
        console.log(files,"files");
      }
```
![[Pasted image 20230901160801.png]]
![[Pasted image 20230901160126.png]]

# FileReader
- blob是不可修改、无法读取里面的内容的。
- [Filereader](https://so.csdn.net/so/search?q=Filereader&spm=1001.2101.3001.7020)提供了读取blob里面内容的方法

[FileReader - Web API 接口参考 | MDN (mozilla.org)](https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader)

## 方法

- [`FileReader.abort()`](https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader/abort
- 中止读取操作。在返回时，`readyState`属性为`DONE`。

- [`FileReader.readAsArrayBuffer()`](https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader/readAsArrayBuffer)
- 开始读取指定的 [`Blob`](https://developer.mozilla.org/zh-CN/docs/Web/API/Blob)中的内容，一旦完成，result 属性中保存的将是被读取文件的 [`ArrayBuffer`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer) 数据对象。

- [`FileReader.readAsBinaryString()`](https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader/readAsBinaryString) 非标准
- 开始读取指定的[`Blob`](https://developer.mozilla.org/zh-CN/docs/Web/API/Blob)中的内容。一旦完成，`result`属性中将包含所读取文件的原始二进制数据。

- [`FileReader.readAsDataURL()`](https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader/readAsDataURL)
- 开始读取指定的[`Blob`](https://developer.mozilla.org/zh-CN/docs/Web/API/Blob)中的内容。一旦完成，`result`属性中将包含一个`data:` URL 格式的 Base64 字符串以表示所读取文件的内容。

- [`FileReader.readAsText()`](https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader/readAsText)
- 开始读取指定的[`Blob`](https://developer.mozilla.org/zh-CN/docs/Web/API/Blob)中的内容。一旦完成，`result`属性中将包含一个字符串以表示所读取的文件内容。

## 事件

- [`FileReader.onabort`](https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader/abort_event)
- 处理[`abort`](https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLMediaElement/abort_event)事件。该事件在读取操作被中断时触发。

- [`FileReader.onerror` (en-US)](https://developer.mozilla.org/en-US/docs/Web/API/FileReader/error_event "Currently only available in English (US)")
- 处理[`error`](https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLElement/error_event)事件。该事件在读取操作发生错误时触发。

- [`FileReader.onload`](https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader/load_event)
- 处理[`load`](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/load_event)事件。该事件在读取操作完成时触发。


# ObjectURL 

- 它是一个用来表示File Object 或Blob Object 的URL

eg. 下载123.html文件
```HTML
    <a id="btn">下载</a>
```
```js
 var str = `<div><p>123</p></div>`;
      var blob = new Blob([str], {
        type: "text/html",
      });
      btn.onclick = function (e) { 
        this.setAttribute("download", "123.html"); // 添加download属性
        this.href = URL.createObjectURL(blob); //得到一个url地址
      };
```

# base64

[Base64 - MDN Web 文档术语表：Web 相关术语的定义 | MDN (mozilla.org)](https://developer.mozilla.org/zh-CN/docs/Glossary/Base64)
在 JavaScript 中，有两个函数被分别用来处理解码和编码 _base64_ 字符串：
- atob()：解码，解码一个 Base64 字符串；
- btoa()：编码，从一个字符串或者二进制数据编码一个 Base64 字符串。

主要使用：
- 将canvas画布内容生成base64的图片 `const base64Str = canvas.toDataURL()`
- 将获取的图片文件，生成base64图片
