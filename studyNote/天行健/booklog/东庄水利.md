
## readme

#### Production
-  vpn: dzsl_txj03/a12345678
-  逆向地理信息解析：http://172.16.2.243:8090/iserver/services/addressmatch-YRGP_DZ_SHP_MAP_YD/restjsr/v1/address
#### 地图需求列表

1. 标注地图：在卫星地图上标记地点
2. 发布iserver地址匹配服务：显示车辆“最后定位位置” （最后定位位置 由经纬度+地址匹配服务 计算的出）；如不能提供，可以使用高德地图地址匹配功能，需要连接高德地图;发布参考：https://blog.csdn.net/supermapsupport/article/details/77933357
3. 目前仅显示东庄地图，东庄区域外呈灰色背景。如需要在东庄区域外显示地图，需要提供：在目前提供的东庄地图底部，叠加一份全国地图，叠加成功后，用iserver发布为一张地图，建议以瓦片地图形式发布。
#### websocket params

![[aba9f547112644e64a4eec6599e3d59.png]]

```
//车辆基本信息
private String dataNo;          //数据号
private String vin;          //vin
private String carNo;            // 车牌号
private String selfNo;            // 自编号
private String orgId;           //组织id
private String orgName;         //组织名称
private String terType = "0";         //终端类型
private String fuelType;         //燃料类型
private String fuelTypeName;         //燃料类型
//定位信息
private Double lng = 0D;                // 偏移经度
private Double lat = 0D;                // 偏移纬度
private Double speed = 0D;            // 当前速度
private Integer direction = 0;        // 方向
/**
 * 状态 在线离线在线标志 0-未知，1-在线，2-离线
 */
private String online = "0";
private Integer onLineBus = 3;      // 车辆状态 业务状态 1 :行驶在线      * 2 :停车在线      * 3 :离线
private String onLineBusText = "离线";      // 车辆状态 业务状态 1 :行驶在线      * 2 :停车在线      * 3 :离线
private String status;            // 定位状态（1定位 0非定位）
private String statusText;            // 定位状态（定位 非定位）
private Double sumMileage = 0D;      // 总里程km
private String dataGeneraTM;    //数据时间
private Long dataGeneraTMLong = 0L;  //数据时间
private String durationTime = "--";  //当前状态持续时间
//行车,停车时间
private String driveOrPackCarTM;

// serverId 值对应的
UN_KNOW("0", "未知请求类型"),
AUTHENTICATION("1", "鉴权"),
RECONNECTION("2", "重连"),
ADD("3", "勾选，新增"),
DEL("4", "去勾选，删除"),
PUSH_HIT_DATA("5", "推送打点数据"),
REAL_INFO_DATA("6", "点击详情数据"),
PUSH_REAL_INFO_DATA("7", "推送详情数据"),
ALL("8", "全量类型请求");
```
## bugs

##### 1. 使用 excel 导出插件报错
[vue引用xlsx-style组件 报错:This relative module was not found: ./cptable in ./node_modules/xlsx-style_this relative module was not found: * ./cptable in-CSDN博客](https://blog.csdn.net/loveLifeLoveCoding/article/details/117280051)

##### 2. `popup` 弹窗有时无信息
`serverId "5", "推送打点数据"` 数据更新时，先删除数据，再重新添加数据。

原代码: `this.createMarker` 只负责打点，`this.nowData this.nowMarker` 等相关数据并未随之更新。 marker点更新了，数据未更新
```js
   updateMarkers (item) {
      // ! 由于要改变车辆方向，因此只能删除后重新打点，相关信息重新存储
      if (this.nowMarkers.has(item.vin)) {
        this.deleteMarkers([item.vin])
        this.createMarker(item).addTo(this.truckLayer)
      }
    },
```
修改：
```js
    updateMarkers (data) {
      // ! 由于要改变车辆方向，因此只能删除后重新打点，相关信息重新存储
      const vins = data.map(i => i.vin)
      this.deleteMarkers(vins)
      this.addMarkers(data)
    },
```

##### tips
1. `v-show`，`v-if` 在img标签上不起作用，解决方法，用一个 `div` 包住

2. 不能选择未来的时间
https://www.jianshu.com/p/9914f65dec7f

3. el-table 出现一条线
[如何解决el-table出现一条线_el-table放大没线缩小有线-CSDN博客](https://blog.csdn.net/weixin_43900414/article/details/108261108)

## booklog



#### 11-29
1. 超速统计-报警列表没有宽度自适应，笔记本屏幕分辨率小，会出现左右拖动条
2. 实时视频-已加载摄像头文字未居中

#### 12.06

嵌入说明：
1. 跳转页面时，请携带参数 `username:string`
2. 本页面会在 `mounted` 钩子内，解析url，如下: 当url未传参数时，会使用默认参数 `"admin"`。页面获取到 `token` 后，才可以打开车辆数。
```js
    getToken () {
      const TokenKey = 'Admin-Token'
      let username
      let paramsUrl = this.$route.query;
      if (paramsUrl.username) {
        username = paramsUrl.username
      } else {
        username = "admin"
      }
      const param = {
        username,
        "clientId": "3298a567-44aa-5ed5-357c-932cc98f969d"
      }
      loginApp(param).then((res) => {
        Cookies.set(TokenKey, res.token)
        Cookies.set('txj_token', res.txj_token)
      })
```
3. 跳转说明,参考如下：
```js
       const param = {
          username: "admin",
        };
        this.$router.push({
          path: "alarmQueryApp | timeMonitorApp 模块地址",
          query: param,
        });
```